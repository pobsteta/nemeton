---
title: "Guide des Tutoriels Interactifs nemeton"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Guide des Tutoriels Interactifs nemeton}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

Le package **nemeton** propose une série de 6 tutoriels interactifs basés sur [learnr](https://rstudio.github.io/learnr/) pour apprendre à calculer les 32 indicateurs forestiers des 12 familles nemeton.

## Prérequis

### Installation des packages

```{r eval=FALSE}
# Packages de base
install.packages(c("sf", "terra", "ggplot2", "dplyr"))

# Packages tutoriels
install.packages(c("learnr", "gradethis", "rappdirs"))

# Packages acquisition IGN
install.packages("happign")

# Packages LiDAR (Tutorial 02)
install.packages("lidR")

# Packages visualisation (Tutorial 06)
install.packages(c("leaflet", "corrplot", "patchwork", "fmsb"))

# Package nemeton
remotes::install_github("pobsteta/nemeton")
```

## Les 6 Tutoriels

### Vue d'ensemble

| # | Tutoriel | Durée | Indicateurs | Description |
|---|----------|-------|-------------|-------------|
| 1 | `01-acquisition` | 45 min | - | Acquisition des données géographiques (IGN, LiDAR) |
| 2 | `02-lidar` | 60 min | C1, P1, P3, A1, E1, E2 | Traitement LiDAR et métriques forestières |
| 3 | `03-terrain` | 40 min | W1-W3, R1-R4, S1-S3, P2, F1 | Indicateurs terrain (12) |
| 4 | `04-ecological` | 40 min | B1-B3, L1-L3, C2, T1-T2, A2, F2, N1-N3 | Indicateurs écologiques (14) |
| 5 | `05-complete` | 40 min | - | Assemblage, normalisation, I_nemeton |
| 6 | `06-analysis` | 50 min | - | Analyse multi-critères et export |

**Durée totale estimée** : 4-5 heures

### Lancer un tutoriel

```{r eval=FALSE}
# Lister les tutoriels disponibles
learnr::available_tutorials("nemeton")

# Lancer un tutoriel spécifique
learnr::run_tutorial("01-acquisition", package = "nemeton")
```

## Détail des Tutoriels

### Tutorial 01 : Acquisition des Données

**Objectif** : Télécharger et préparer les données nécessaires pour les tutoriels suivants.

**Données acquises** :
- Zone d'étude (emprise géographique)
- Parcelles cadastrales (GeoPackage)
- MNT (Modèle Numérique de Terrain)
- Dalles LiDAR HD
- BD TOPO (routes, bâtiments, cours d'eau)
- BD Forêt V2

**Sortie** : `~/nemeton_tutorial_data/` contenant toutes les données brutes.

### Tutorial 02 : Traitement LiDAR

**Objectif** : Extraire des métriques forestières à partir des nuages de points LiDAR.

**Indicateurs calculés** (6) :
- **C1** : Stock de biomasse aérienne
- **P1** : Volume de bois sur pied
- **P3** : Proportion bois d'oeuvre
- **A1** : Couverture forestière
- **E1** : Potentiel bois-énergie
- **E2** : Évitement d'émissions carbone

**Sortie** : `indicateurs_lidar.gpkg`

### Tutorial 03 : Indicateurs Terrain

**Objectif** : Calculer les indicateurs dérivés du MNT et de la BD TOPO.

**Indicateurs calculés** (12) :
- **W1-W3** : Famille Eau (TWI, réseau hydro, zones humides)
- **R1-R4** : Famille Résilience (risques feu, tempête, sécheresse, gibier)
- **S1-S3** : Famille Santé (sentiers, accessibilité, proximité)
- **P2** : Productivité forestière
- **F1** : Fertilité du sol

**Sortie** : `indicateurs_terrain.gpkg`

### Tutorial 04 : Indicateurs Écologiques

**Objectif** : Calculer les indicateurs de biodiversité, paysage et naturalité.

**Indicateurs calculés** (14) :
- **B1-B3** : Famille Biodiversité (protection, structure, connectivité)
- **L1-L3** : Famille Paysage (lisière, fragmentation, TVB)
- **C2** : Vitalité NDVI
- **T1-T2** : Famille Trame (ancienneté, changement)
- **A2** : Qualité de l'air
- **F2** : Risque d'érosion
- **N1-N3** : Famille Naturalité (distance, continuité, composite)

**Sortie** : `indicateurs_ecologiques.gpkg`

### Tutorial 05 : Calcul Complet

**Objectif** : Assembler tous les indicateurs, normaliser et créer l'indice composite.

**Étapes** :
1. Jointure des 32 indicateurs
2. Normalisation Min-Max [0-1]
3. Inversion des indicateurs négatifs
4. Calcul des scores par famille (12 familles)
5. Calcul de l'indice composite I_nemeton

**Sortie** : `parcelles.gpkg` avec 32 indicateurs + 12 scores famille + I_nemeton

### Tutorial 06 : Analyse Multi-Critères

**Objectif** : Visualiser, analyser et exporter les résultats.

**Analyses** :
- Cartes thématiques par famille
- Diagrammes radar (profils parcelles)
- Matrice de corrélation (synergies/compromis)
- Identification des hotspots
- Front de Pareto
- Clustering des parcelles
- Export GeoPackage, CSV, carte Leaflet

**Sortie** : Fichiers d'analyse et carte interactive

## Structure du Cache

Les données sont stockées dans un répertoire persistant :

```{r eval=FALSE}
# Localisation du cache
rappdirs::user_data_dir("nemeton")
```

- **Linux** : `~/.local/share/nemeton/tutorial_data/`
- **macOS** : `~/Library/Application Support/nemeton/tutorial_data/`
- **Windows** : `%LOCALAPPDATA%/nemeton/nemeton/tutorial_data/`

### Nettoyer le cache

```{r eval=FALSE}
cache_dir <- rappdirs::user_data_dir("nemeton")
unlink(file.path(cache_dir, "tutorial_data"), recursive = TRUE)
```

## Les 12 Familles d'Indicateurs

| Code | Famille | Indicateurs |
|------|---------|-------------|
| C | Carbone | C1 (biomasse), C2 (NDVI) |
| B | Biodiversité | B1 (protection), B2 (structure), B3 (connectivité) |
| W | Water (Eau) | W1 (TWI), W2 (réseau hydro), W3 (zones humides) |
| A | Air | A1 (couverture), A2 (qualité) |
| F | Fertilité | F1 (sol), F2 (érosion) |
| L | Landscape | L1 (lisière), L2 (fragmentation), L3 (TVB) |
| T | Trame | T1 (ancienneté), T2 (changement) |
| R | Résilience | R1 (feu), R2 (tempête), R3 (sécheresse), R4 (gibier) |
| S | Santé | S1 (sentiers), S2 (accessibilité), S3 (proximité) |
| P | Production | P1 (volume), P2 (productivité), P3 (qualité) |
| E | Énergie | E1 (bois-énergie), E2 (évitement) |
| N | Naturalité | N1 (distance), N2 (continuité), N3 (composite) |

## Dépannage

### "Tutorial not found"

```{r eval=FALSE}
# Vérifier l'installation
packageVersion("nemeton")

# Réinstaller
remotes::install_github("pobsteta/nemeton", force = TRUE)
```

### "Cannot download data"

Les APIs IGN peuvent être temporairement indisponibles. Le tutoriel utilisera les données de démonstration si disponibles.

### "Out of memory" (LiDAR)

```{r eval=FALSE}
# Augmenter la mémoire
options(future.globals.maxSize = +Inf)
```

### "Exercise timeout"

Les exercices LiDAR ont un timeout de 10 minutes. Relancez l'exercice si nécessaire (les données sont en cache).

## Ressources

- [Documentation nemeton](https://pobsteta.github.io/nemeton/)
- [GitHub nemeton](https://github.com/pobsteta/nemeton)
- [Référentiel des 12 familles](https://pobsteta.github.io/nemeton/articles/complete-referential_fr.html)
- [learnr documentation](https://rstudio.github.io/learnr/)
- [lidR documentation](https://r-lidar.github.io/lidRbook/)
