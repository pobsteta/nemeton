---
title: "D√©marrage rapide avec nemeton"
author: "Pascal Obst√©tar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{D√©marrage rapide avec nemeton}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  warning = FALSE,
  message = FALSE
)
```

> üåç **English version**: See `vignette("getting-started")` | **Version fran√ßaise** : Ce document

# Introduction

Le package `nemeton` impl√©mente la m√©thode Nemeton pour l'analyse syst√©mique de territoires forestiers. Il fournit des outils pour :

- Calculer des indicateurs biophysiques multi-famille (carbone, eau, sols, paysage, etc.)
- Normaliser les valeurs d'indicateurs selon plusieurs m√©thodes
- Cr√©er des indices composites pour une √©valuation holistique
- Visualiser les r√©sultats avec des cartes et graphiques

Cette vignette d√©montre le workflow complet avec le jeu de donn√©es `massif_demo`.

# Installation

```{r, eval = FALSE}
# Depuis GitHub
remotes::install_github("pobsteta/nemeton")
```

```{r, eval = FALSE}
library(nemeton)
library(ggplot2)
```

# Charger les donn√©es de d√©monstration

Le package inclut un jeu de donn√©es synth√©tique (`massif_demo`) repr√©sentant une zone de 5km √ó 5km avec 20 parcelles foresti√®res.

```{r, eval = FALSE}
# Charger les parcelles foresti√®res
data(massif_demo_units)

# Inspecter les parcelles
print(massif_demo_units)

# Statistiques sommaires
cat("\nSurface totale:", sum(massif_demo_units$surface_ha), "ha\n")
table(massif_demo_units$forest_type)
```

```{r fig.cap = "Parcelles foresti√®res par type", eval = FALSE}
ggplot(massif_demo_units) +
  geom_sf(aes(fill = forest_type)) +
  theme_minimal() +
  labs(title = "Massif Demo - Types forestiers",
       fill = "Type de for√™t")
```

# Charger les couches spatiales

Utilisez `massif_demo_layers()` pour charger tous les rasters et vecteurs associ√©s :

```{r, eval = FALSE}
layers <- massif_demo_layers()
print(layers)
```

Le jeu de donn√©es inclut :
- **Rasters** : biomasse, MNT, occupation du sol, richesse sp√©cifique
- **Vecteurs** : r√©seau routier, cours d'eau

# Calculer les indicateurs

## Indicateurs individuels

```{r, eval = FALSE}
# Carbone (stock de biomasse)
carbon <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = "carbon"
)

# Eau (r√©gulation hydrique)
water <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = "water"
)

# Afficher les r√©sultats
head(carbon[, c("parcel_id", "forest_type", "carbon")])
```

## Indicateurs multiples simultan√©s

```{r, eval = FALSE}
# Calculer 5 indicateurs en une fois
results <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = c("carbon", "biodiversity", "water",
                 "fragmentation", "accessibility")
)

# Vue d'ensemble
summary(results[, c("carbon", "biodiversity", "water")])
```

# Normalisation

Normalisez les indicateurs pour les rendre comparables (√©chelle 0-100) :

```{r, eval = FALSE}
# Normalisation min-max
normalized <- normalize_indicators(
  results,
  indicators = c("carbon", "biodiversity", "water"),
  method = "minmax"
)

# Comparer avant/apr√®s
cat("\nAvant normalisation (carbone):\n")
summary(results$carbon)

cat("\nApr√®s normalisation (carbone):\n")
summary(normalized$carbon_norm)
```

## M√©thodes de normalisation

```{r, eval = FALSE}
# z-score (distribution normale centr√©e-r√©duite)
norm_zscore <- normalize_indicators(
  results,
  indicators = "carbon",
  method = "zscore"
)

# Quantiles (distribution uniforme)
norm_quantile <- normalize_indicators(
  results,
  indicators = "carbon",
  method = "quantile"
)
```

# Agr√©gation en indices composites

Combinez plusieurs indicateurs en un indice unique :

```{r, eval = FALSE}
# Indice composite avec poids √©gaux
composite <- create_composite_index(
  normalized,
  indicators = c("carbon_norm", "biodiversity_norm", "water_norm"),
  name = "ecosystem_health"
)

# Afficher les r√©sultats
head(composite[, c("parcel_id", "forest_type", "ecosystem_health")])
```

## Agr√©gation pond√©r√©e

```{r, eval = FALSE}
# Poids personnalis√©s (carbone 50%, biodiversit√© 30%, eau 20%)
composite_weighted <- create_composite_index(
  normalized,
  indicators = c("carbon_norm", "biodiversity_norm", "water_norm"),
  weights = c(0.5, 0.3, 0.2),
  name = "conservation_index"
)
```

## M√©thodes d'agr√©gation

```{r, eval = FALSE}
# Moyenne g√©om√©trique (effets multiplicatifs)
composite_geom <- create_composite_index(
  normalized,
  indicators = c("carbon_norm", "water_norm"),
  aggregation = "geometric_mean",
  name = "water_carbon_index"
)

# Minimum (approche conservatrice, facteur limitant)
composite_min <- create_composite_index(
  normalized,
  indicators = c("carbon_norm", "biodiversity_norm"),
  aggregation = "min",
  name = "minimum_performance"
)
```

# Visualisation

## Cartes th√©matiques

```{r fig.cap = "Carte de l'indice de sant√© √©cosyst√©mique", eval = FALSE}
plot_indicators_map(
  composite,
  indicator = "ecosystem_health",
  title = "Indice de sant√© √©cosyst√©mique",
  legend_title = "Score (0-100)"
)
```

## Cartes de comparaison

```{r fig.cap = "Comparaison carbone vs biodiversit√©", fig.width = 10, eval = FALSE}
plot_comparison_map(
  normalized,
  indicators = c("carbon_norm", "biodiversity_norm"),
  titles = c("Stock de carbone", "Biodiversit√©"),
  ncol = 2
)
```

## Graphique radar

```{r fig.cap = "Profil √©cosyst√©mique - Parcelle P01", eval = FALSE}
nemeton_radar(
  normalized,
  unit_id = "P01",
  indicators = c("carbon_norm", "biodiversity_norm", "water_norm",
                 "fragmentation_norm", "accessibility_norm"),
  title = "Profil multi-indicateurs - Parcelle P01"
)
```

# Workflow complet

Voici un exemple de workflow complet de bout en bout :

```{r, eval = FALSE}
# 1. Charger les donn√©es
data(massif_demo_units)
layers <- massif_demo_layers()

# 2. Calculer les indicateurs
results <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = c("carbon", "biodiversity", "water",
                 "fragmentation", "accessibility")
)

# 3. Normaliser (0-100)
normalized <- normalize_indicators(
  results,
  indicators = c("carbon", "biodiversity", "water",
                 "fragmentation", "accessibility"),
  method = "minmax"
)

# 4. Cr√©er un indice composite
composite <- create_composite_index(
  normalized,
  indicators = c("carbon_norm", "biodiversity_norm", "water_norm"),
  weights = c(0.4, 0.4, 0.2),
  name = "forest_quality"
)

# 5. Visualiser
plot_indicators_map(
  composite,
  indicator = "forest_quality",
  title = "Indice de qualit√© foresti√®re"
)
```

# Analyses avanc√©es

## Inverser un indicateur

Pour les indicateurs o√π une valeur faible est souhaitable (ex: fragmentation) :

```{r, eval = FALSE}
# Inverser la fragmentation (moins fragment√© = mieux)
normalized_inv <- invert_indicator(
  normalized,
  indicators = "fragmentation_norm",
  suffix = "_inv"
)

# La fragmentation invers√©e refl√®te maintenant la continuit√©
head(normalized_inv[, c("parcel_id", "fragmentation_norm", "fragmentation_norm_inv")])
```

## Filtrage et sous-ensembles

```{r, eval = FALSE}
# S√©lectionner uniquement les futaies feuillues
broadleaf <- normalized[normalized$forest_type == "Futaie feuillue", ]

# Cr√©er un indice sp√©cifique
broadleaf_index <- create_composite_index(
  broadleaf,
  indicators = c("carbon_norm", "biodiversity_norm"),
  name = "broadleaf_quality"
)
```

# Internationalisation

Le package supporte le fran√ßais et l'anglais :

```{r, eval = FALSE}
# D√©finir la langue
nemeton_set_language("fr")  # Fran√ßais
# nemeton_set_language("en")  # English

# Les messages d'erreur/information seront dans la langue choisie
```

# Export des r√©sultats

```{r eval = FALSE}
# Export en GeoPackage
sf::st_write(composite, "results/forest_quality.gpkg")

# Export en CSV (sans g√©om√©trie)
results_table <- composite %>%
  sf::st_drop_geometry()
write.csv(results_table, "results/forest_quality.csv", row.names = FALSE)
```

# Prochaines √©tapes

- **Analyse temporelle** : `vignette("temporal-analysis_fr")` - Analyse multi-p√©riodes
- **Familles d'indicateurs** : `vignette("indicator-families_fr")` - Syst√®me 12 familles
- **Internationalisation** : `vignette("internationalization")` - Syst√®me i18n

# R√©f√©rences

- M√©thode Nemeton : D√©velopp√©e par Vivre en For√™t
- Documentation compl√®te : `help(package = "nemeton")`
- Site web : https://pobsteta.github.io/nemeton/

# Session Info

```{r, eval = FALSE}
sessionInfo()
```
