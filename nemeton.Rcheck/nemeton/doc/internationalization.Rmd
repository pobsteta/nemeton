---
title: "Internationalisation (i18n)"
author: "Pascal Obstétar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Internationalisation (i18n)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE
)
```

# Introduction

Le package `nemeton` supporte nativement le **français** et l'**anglais** pour tous les messages, erreurs et documentations. Cette vignette explique comment utiliser le système d'internationalisation (i18n).

```{r}
library(nemeton)
```

# Langues supportées

| Code | Langue | Statut |
|------|--------|--------|
| `fr` | Français | Complet |
| `en` | English | Complet |

# Définir la langue

## Langue par défaut

Par défaut, le package détecte la langue du système :

```{r}
# Afficher la langue actuelle
Sys.getenv("LANG")
```

## Changer la langue

Utilisez `nemeton_set_language()` pour définir explicitement la langue :

```{r}
# Passer en français
nemeton_set_language("fr")

# Switch to English
nemeton_set_language("en")
```

## Vérifier la langue active

```{r, eval = FALSE}
# La langue est stockée dans une option
getOption("nemeton.lang")
# [1] "fr"  ou "en"
```

# Messages et erreurs

Les messages d'information, d'avertissement et d'erreur s'affichent dans la langue définie.

## Exemple en français

```{r, eval = FALSE}
nemeton_set_language("fr")

# Erreur si données manquantes
nemeton_compute(NULL, NULL, "carbon")
# Erreur : Les données 'data' doivent être un objet sf
```

## Example in English

```{r, eval = FALSE}
nemeton_set_language("en")

# Error with missing data
nemeton_compute(NULL, NULL, "carbon")
# Error: 'data' must be an sf object
```

# Messages disponibles

Le système i18n couvre :

- **Erreurs de validation** : Types de données, paramètres manquants
- **Avertissements** : Indicateurs manquants, valeurs atypiques
- **Messages d'information** : Progression des calculs, résultats
- **Noms de familles** : Labels pour les 12 familles d'indicateurs

# Noms de familles bilingues

```{r, eval = FALSE}
# En français
nemeton_set_language("fr")
get_family_name("C")
# [1] "Carbone & Vitalité"

get_family_name("W")
# [1] "Eau"

# In English
nemeton_set_language("en")
get_family_name("C")
# [1] "Carbon & Vitality"

get_family_name("W")
# [1] "Water Regulation"
```

# Persistance de la langue

La langue définie reste active pour toute la session R :

```{r, eval = FALSE}
# Définir le français au début du script
nemeton_set_language("fr")

# Tous les appels suivants utilisent le français
results <- nemeton_compute(...)
normalized <- normalize_indicators(...)
plot_indicators_map(...)
```

# Documentation bilingue

## Aide des fonctions

La documentation des fonctions (help) est en **anglais** (standard R), avec des exemples en français dans les vignettes.

```{r, eval = FALSE}
?nemeton_compute
?plot_indicators_map
```

## Vignettes

Les vignettes sont disponibles en **français** :

- `vignette("getting-started_fr")` - Démarrage rapide
- `vignette("indicator-families_fr")` - Familles d'indicateurs
- `vignette("temporal-analysis_fr")` - Analyse temporelle

# Contribuer aux traductions

Le système i18n utilise des fichiers de traduction dans `R/i18n.R`.

## Structure des messages

```{r, eval = FALSE}
# Exemple de structure interne
messages <- list(
  fr = list(
    error_no_data = "Les données 'data' doivent être un objet sf",
    info_computing = "Calcul de {n} indicateurs..."
  ),
  en = list(
    error_no_data = "'data' must be an sf object",
    info_computing = "Computing {n} indicators..."
  )
)
```

## Ajouter une traduction

Pour contribuer une nouvelle langue :

1. Créer une nouvelle section dans `R/i18n.R`
2. Traduire tous les messages
3. Mettre à jour `nemeton_set_language()` pour supporter le nouveau code langue
4. Soumettre une Pull Request

# Exemple complet bilingue

```{r, eval = FALSE}
# ===== VERSION FRANÇAISE =====
nemeton_set_language("fr")

data(massif_demo_units)
layers <- massif_demo_layers()

results <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = "carbon"
)
# ℹ Calcul de 1 indicateurs...
# ✔ 1/1 indicateurs calculés

plot_indicators_map(
  results,
  indicators = "carbon",
  title = "Stock de carbone",
  legend_title = "Mg C/parcel"
)

# ===== ENGLISH VERSION =====
nemeton_set_language("en")

data(massif_demo_units)
layers <- massif_demo_layers()

results <- nemeton_compute(
  massif_demo_units,
  layers,
  indicators = "carbon"
)
# ℹ Computing 1 indicators...
# ✔ 1/1 indicators computed

plot_indicators_map(
  results,
  indicators = "carbon",
  title = "Carbon Stock",
  legend_title = "Mg C/parcel"
)
```

# Bonnes pratiques

1. **Définir la langue une seule fois** au début du script
2. **Documenter la langue utilisée** dans vos analyses
3. **Utiliser les noms de familles localisés** avec `get_family_name()`
4. **Tester les deux langues** si vous partagez du code international

# Limitations

- **Documentation R** : Aide des fonctions uniquement en anglais (standard CRAN)
- **Noms de colonnes** : Identifiants techniques toujours en anglais (ex: `carbon_norm`)
- **Palettes et thèmes** : Labels graphiques définis par l'utilisateur

# Roadmap

**Versions futures** :
- Support additionnel : Espagnol, Italien, Allemand
- Traduction automatique des labels de graphiques
- Templates de rapports multilingues

# Session Info

```{r}
sessionInfo()
```
